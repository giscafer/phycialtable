<!DOCTYPE html>
<html>
<meta charset="utf-8">
<#include "../common/head.html"/>
<body>
	<nav class="navbar navbar-inverse" role="navigation">
		<div class="container-fluid">
			<!-- Brand and toggle get grouped for better mobile display -->
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed"
					data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
					<span class="sr-only"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span> <span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="#"></a>
			</div>

			<div class="collapse navbar-collapse"
				id="bs-example-navbar-collapse-1">
				<ul class="nav navbar-nav">
					<p class="navbar-text">成绩单管理页</p>
				</ul>
				<ul class="nav navbar-nav navbar-right">
					<p class="navbar-text">
						<span class="glyphicon glyphicon-user"></span> 欢迎您：<span
							id="login_username">${username!''}</span>
					</p>
					<p class="navbar-text">
						今日共新增&nbsp;<span class="badge" id="xinzeng"
							style="cursor:pointer;" onclick="checkToday();">0</span>&nbsp;条数据
					</p>
					<li><a href="#" id="sys_exit" onclick="loginOut();"><span
							class="glyphicon glyphicon-off"></span>退出系统</a>
					</li>
				</ul>
			</div>
		</div>
	</nav>
	<div class="container-fluid">

		<div id="toolbar">
			<!-- <button type="button" class="btn btn-default" onclick="exporyAll();">
				<span class="glyphicon glyphicon-arrow-down"></span> 导出历史数据到excel
			</button> -->
			<a id="remove" class="btn btn-info" href="add">
				<i class="glyphicon glyphicon-ok"></i> 新增
			</a>

		</div>
		<table id="dtb" data-toggle="table" data-url="reportlist"
			data-toolbar="#toolbar" class="table table-hover"
			data-show-columns="false" data-search="true" data-show-refresh="true"
			data-show-toggle="false" data-show-export="true"
			data-export-types="['excel']"
			data-height="450" data-side-pagination="server"
			data-pagination="true" data-page-list="[5, 10, 20, 50, 100, 200]"
			data-query-params="makeparmter">
			<thead>
				<tr>
					<th data-field="studentid" rowspan="2" data-valign="middle">编号\项目</th>
					<th colspan="2" data-align="center">性别&年龄</th>
					<th colspan="2" data-align="center">全场3/4场加速跑（s）</th>
					<th colspan="2" data-align="center">15m*17折返跑（s）</th>
					<th colspan="2" data-align="center">立定跳远（m）</th>
					<th colspan="2" data-align="center">1min 仰卧起坐（次）</th>
					<th colspan="2" data-align="center">助跑单脚跳摸高（m）</th>
					<th colspan="2" data-align="center">双摇跳绳（次）</th>
					<th colspan="2" data-align="center">体前屈（cm）</th>
					<th colspan="2" data-align="center">跳起空中转体双手头上传球（m）</th>
					<th rowspan="2" data-align="center" data-valign="middle"
						data-formatter="operateFormatter" data-events="operateEvents">操作</th>
				</tr>
				<tr>
					<!-- 性别&年龄 -->
					<th data-field="sex" data-align="center">性别</th>
					<th data-field="age" data-align="center">年龄</th>
					<!--全场3/4场加速跑（s）  -->
					<th data-field="qcjsp_grade" data-align="center">成绩</th>
					<th data-field="qcjsp_score" data-align="center">分数</th>
					<!--15m*17折返跑（s）  -->
					<th data-field="zfp_grade" data-align="center">成绩</th>
					<th data-field="zfp_score" data-align="center">分数</th>

					<!-- 立定跳远 -->
					<th data-field="ldty_grade" data-align="center">成绩</th>
					<th data-field="ldty_score" data-align="center">分数</th>
					<!--1min 仰卧起坐（次）  -->
					<th data-field="ywqz_grade" data-align="center">成绩</th>
					<th data-field="ywqz_score" data-align="center">分数</th>
					<!--助跑单脚跳摸高（m）  -->
					<th data-field="zpdjtmg_grade" data-align="center">成绩</th>
					<th data-field="zpdjtmg_score" data-align="center">分数</th>
					<!-- 双摇跳绳（次） -->
					<th data-field="syts_grade" data-align="center">成绩</th>
					<th data-field="syts_score" data-align="center">分数</th>
					<!-- 体前屈（cm） -->
					<th data-field="tqq_grade" data-align="center">成绩</th>
					<th data-field="tqq_score" data-align="center">分数</th>
					<!-- 跳起空中转体双手头上传球（m） -->
					<th data-field="tqsstscq_grade" data-align="center">成绩</th>
					<th data-field="tqsstscq_score" data-align="center">分数</th>
				</tr>
			</thead>
		</table>
	</div>
</body>
<script type="text/javascript">
	    $(function(){
	    	$.getJSON('newdata',function(data){
	    		$("#xinzeng").text(data.newcount);
	    		if(Number(data.newcount)!=0){
	    			$("#xinzeng").tooltip({"title":"今日新增数据，点击查看","placement":"bottom"});
	    			$("#xinzeng").mouseover();
	    		}
	    		$("#login_username").text(data.username);
	    		
	    	});
	    });
    
    	function operateFormatter(value, row, index) {
	        return [
	            '<a class="edit ml10" style="color:black;" href="javascript:void(0)" title="编辑">',
	                '<span class="glyphicon glyphicon-edit"></span>',
	            '</a>&emsp;',
	            '<a class="remove ml10" style="color:black;" href="javascript:void(0)" title="删除">',
	                '<i class="glyphicon glyphicon-remove"></i>',
	            '</a>'
	        ].join('');
	    }
    	
    	function hideIdFormatter(value, row, index) {
	        return "<input type='hidden' value="+value+" name='id' />";
	    }
    	
	    window.operateEvents = {
	        'click .like': function (e, value, row, index) {
	            console.log(value, row, index);
	        },
	        'click .edit': function (e, value, row, index) {
	        	$("#waitph").val($("[data-index="+index+"]").find('td').eq(3).text());
	        	$("#edituc").modal("show");
	            //console.log(value, row, index);
	        },
	        'click .remove': function (e, value, row, index) {
	            var delid=$("[data-index="+index+"]").find('td').eq(0).children().first().val();
	            if(confirm("确定删除该条记录吗？"+delid)){
	            	$.getJSON('user/delete',{"id":delid},function(data){
	            		$("#dtb").bootstrapTable('refresh');
		            });	
	            }
	            console.log(value, row, index);
	        }
	    };
	    
	    function refreshTable(){
	    	$("table").bootstrapTable('refresh', {
                url:$("table").attr('data-url')
            });
	    }
	    
       function makeparmter(params) {
    	   params.queryby=$("#queryby").val();
    	   var ret='';
    	   for(var i in params){
    	       ret+=i+':'+params[i];
    	   }
    	   //alert(ret);
    	   return params;
       }
       
       function saveUcode(){
    	   //alert($("#waiteduc").val());
    	   //alert($("#waitph").val());
    	   $.post('user/edit',{"phone":$("#waitph").val(),"uc":$("#waiteduc").val()},function(){
    		   //alert('保存成功!');
    		   $("#edituc").modal('hide');
    		   $("#waiteduc").val('');
        	   $("#waitph").val('');
        	   refreshTable();
    	   });
       }
       
       function checkToday(){
    	   $("#queryby").val('0');
    	   refreshTable();
       }
       
       function checkAll(){
    	   $("#queryby").val('1');
    	   refreshTable();
       }
       
       function loginOut(){
    	   if(confirm("确定退出系统吗")){
    		   window.location.href="../exit";
    	   }
       }
       function exporyToday(){
    	   if(confirm("确定导出当天记录吗？")){
    		   window.location.href="user/export";
    	   }
       }
       function exporyAll(){
    	   if(confirm("确定导出所有记录吗？")){
    		   window.location.href="export";
    	   }
       }
    </script>
</html>
